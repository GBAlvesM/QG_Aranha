<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/quiz.css">
    <link rel="shortcut icon" href="assets/favicon.png" type="image/x-icon">
    <title>Quiz</title>
</head>
<body onload="onloadEsconder()">
    <div class="container">
        <div class="volta"><a href="index.html" class="voltar">Voltar ao site</a></div>
        <div id="btnIniciarQuiz"><button onclick="iniciarQuiz()">Iniciar quiz</button></div>
        <div class="box" id="jogo">
            <img src="assets/favicon.png" alt="" class="logo">
            <div id="resultados">
                <div id="acertos">
                    Você acertou <span id="finalAcertos"></span> de <span id="quantQuestoes2"></span> questões
                </div>
                <div id="classificacao">
                    <div id="tituloClassificacao"></div>
                    <div id="txtClassificacao"></div>
                </div>
            </div>
            <div id="questoes">Questão: <span id="questaoA"></span> de <span id="quantQuestoes"></span></div>
            <div id="questaoAt">
                <span id="txtQuestao"></span>
            </div>
            <div id="informacao">
                <span>Escolha uma das alternativas abaixo:</span>
            </div>
            <div id="opcoes">
                <div id="linha1">
                    <span>
                        <input type="radio" name="option" id="opcaoA" class="radio" value="alternativaA">
                        <label for="opcaoA" class="option" id="labelOpcaoA">a</label>
                    </span>
                    <span>
                        <input type="radio" name="option" id="opcaoB" class="radio" value="alternativaB">
                        <label for="opcaoB" class="option" id="labelOpcaoB">b</label>
                    </span>
                </div>
                <div id="linha2">
                    <span>
                        <input type="radio" name="option" id="opcaoC" class="radio" value="alternativaC">
                        <label for="opcaoC" class="option" id="labelOpcaoC">c</label>
                    </span>
                    <span>
                        <input type="radio" name="option" id="opcaoD" class="radio" value="alternativaD">
                        <label for="opcaoD" class="option" id="labelOpcaoD">d</label>
                    </span>
                </div>
            </div>
            <div id="botoes">
                <button onclick="submeter()" id="btnSubmeter">Enviar resposta</button>
                <button onclick="avancar()" id="btnProx" disabled>Ir para próxima questão</button>
                <button onclick="resultados()" style="display: none;" id="btnDash">Ver seu desempenho</button>
                <button onclick="tentarNovamente()" id="btnTentarNovamente" disabled>Tentar novamente</button>
            </div>
        </div>
    </div>
</body> 
<script>
    const listaDeQuestoes = [

        {
        pergunta: 'Qual é o nome do cientista brilhante que se torna o vilão Doutor Octopus?',
        alternativaA: 'Curt Connors',
        alternativaB: 'Otto Octavius',
        alternativaC: 'Adrian Toomes',
        alternativaD: 'Flint Marko',
        alternativaCorreta: 'alternativaB'
        },
        {
        pergunta: 'Qual personagem de apoio é famoso por ser o editor-chefe do jornal Daily Bugle e por constantemente difamar o Homem-Aranha em suas manchetes?',
        alternativaA: 'Robbie Robertson',
        alternativaB: 'Norman Osborn',
        alternativaC: 'J. Jonah. Jameson (JJJ)',
        alternativaD: 'George Stacy',
        alternativaCorreta: 'alternativaC' 
        },
        {
        pergunta: 'Em qual bairro de Nova York Peter Parker viveu a maior parte de sua vida com a Tia May e o Tio Ben?',
        alternativaA: 'Manhattam',
        alternativaB: 'Metrópolis',
        alternativaC: 'Queens',
        alternativaD: 'Brooklyn',
        alternativaCorreta: 'alternativaC' 
        },
        {
        pergunta: 'Qual é a habilidade que alerta Peter Parker de perigos antes que eles aconteçam, conhecida como o "zumbido" na cabeça?',
        alternativaA: 'Visão de Aranha',
        alternativaB: 'Sentido Alerta',
        alternativaC: 'Reflexo aprimorado',
        alternativaD: 'Sentido Aranha',
        alternativaCorreta: 'alternativaD' 
        },
        {
        pergunta: 'Qual é o nome verdadeiro do vilão original e mais icônico Duende Verde?',
        alternativaA: 'Norman Osborn',
        alternativaB: 'Flash Thompson',
        alternativaC: 'Harry Osborn',
        alternativaD: 'Rodercik Kingsley',
        alternativaCorreta: 'alternativaA' 
        },
        {
        pergunta: 'Quem foi o criador dos Lançadores de Teia do Homem-Aranha, o equipamento que permite disparar as teias?',
        alternativaA: 'Tony Stark',
        alternativaB: 'Reed Richards',
        alternativaC: 'Otto Octavius',
        alternativaD: 'Peter Parker',
        alternativaCorreta: 'alternativaD' 
        },
        {
        pergunta: 'Antes de se tornar o vilão Venom, qual repórter do Daily Bugle se uniu ao simbionte alienígena em busca de vingança contra Peter Parker?',
        alternativaA: 'Cletus Kasady',
        alternativaB: 'Eddie Brock',
        alternativaC: 'Mac Gargan',
        alternativaD: 'Flash Thompson',
        alternativaCorreta: 'alternativaB' 
        },
        {
        pergunta: 'Qual é a palavra chave que completa o lema do Tio Ben: "Com grandes poderes, vêm grandes..."?',
        alternativaA: 'Sacrifícios',
        alternativaB: 'Recompensas',
        alternativaC: 'Responsabilidades',
        alternativaD: 'Perigos',
        alternativaCorreta: 'alternativaC' 
        },
        {
        pergunta: 'Qual é o trabalho mais comum de Peter Parker para se sustentar?',
        alternativaA: 'Fotógrafo',
        alternativaB: 'Carteiro',
        alternativaC: 'Professor de Ciências',
        alternativaD: 'Cientista de Laboratório',
        alternativaCorreta: 'alternativaA' 
        },
        {
        pergunta: 'Qual é o nome da garota que Peter Parker considerou seu primeiro amor, conhecida por sua morte trágica causada pelo Duende Verde?',
        alternativaA: 'Liz Allan',
        alternativaB: 'Mary Jane Watson',
        alternativaC: 'Betty Brant',
        alternativaD: 'Gwen Stacy',
        alternativaCorreta: 'alternativaD' 
        }
    ]

    let numeroDaQuestaoAtual = 0
    let pontuacaoFinal = 0
    let tentativaIncorreta = 0
    let certas = 0
    let erradas = 0
    let quantidadeDeQuestoes = listaDeQuestoes.length
    // let isUltima = numeroDaQuestaoAtual == quantidadeDeQuestoes-1 ? true : false

    function onloadEsconder() {
        document.getElementById('jogo').style.display = "none"
    }

    function iniciarQuiz() {
        document.getElementById('jogo').style.display = "flex"
        document.getElementById('btnIniciarQuiz').style.display = "none"

        document.getElementById('quantQuestoes').innerHTML = quantidadeDeQuestoes

        preencherHTMLcomQuestaoAtual(0)

        btnSubmeter.disabled = false
        btnProx.disabled = true
        // btnConcluir.disabled = true
        btnTentarNovamente.disabled = true
    }

    function preencherHTMLcomQuestaoAtual(index) {
        habilitarAlternativas(true)
        const questaoAtual = listaDeQuestoes[index]
        numeroDaQuestaoAtual = index
        console.log("questaoAtual")
        console.log(questaoAtual)
        document.getElementById("questaoA").innerHTML = Number(index) + 1 // ajustando porque o index começa em 0
        document.getElementById("txtQuestao").innerHTML = questaoAtual.pergunta;
        document.getElementById("labelOpcaoA").innerHTML = questaoAtual.alternativaA;
        document.getElementById("labelOpcaoB").innerHTML = questaoAtual.alternativaB;
        document.getElementById("labelOpcaoC").innerHTML = questaoAtual.alternativaC;
        document.getElementById("labelOpcaoD").innerHTML = questaoAtual.alternativaD;
    }

    function submeter() {
        const options = document.getElementsByName("option"); // recupera alternativas no html

        let hasChecked = false
        for (let i = 0; i < options.length; i++) {
            if (options[i].checked) {
                hasChecked = true
                break
            }
        }

        if (!hasChecked) {
            alert("Não há alternativas escolhidas. Escolha uma opção.")
        } else {
            btnSubmeter.disabled = true
            btnProx.disabled = false

            habilitarAlternativas(false)

            checarResposta()
        }
    }

    function habilitarAlternativas(trueOrFalse) {
        let opcaoEscolhida = trueOrFalse ? false : true

        opcaoA.disabled = opcaoEscolhida
        opcaoB.disabled = opcaoEscolhida
        opcaoC.disabled = opcaoEscolhida
        opcaoD.disabled = opcaoEscolhida

    }

    function avancar() {
        btnProx.disabled = true
        btnSubmeter.disabled = false

        desmarcarRadioButtons()

        if (numeroDaQuestaoAtual < quantidadeDeQuestoes - 1) {
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
        } else if (numeroDaQuestaoAtual == quantidadeDeQuestoes - 1) {
            alert("Atenção... a próxima é a ultima questão!")
            preencherHTMLcomQuestaoAtual(numeroDaQuestaoAtual)
            btnProx.innerHTML = 'Finalizar quiz'
        } else {
            finalizarJogo()
        }
        limparCoresBackgroundOpcoes()
    }

    function tentarNovamente() {
        // atualiza a página
        window.location.reload()
    }

    function checarResposta() {
        const questaoAtual = listaDeQuestoes[numeroDaQuestaoAtual] // questão atual 
        const respostaQuestaoAtual = questaoAtual.alternativaCorreta // qual é a resposta correta da questão atual

        const options = document.getElementsByName("option"); // recupera alternativas no html

        let alternativaCorreta = null // variável para armazenar a alternativa correta

        options.forEach((option) => {
            if (option.value === respostaQuestaoAtual) {
                console.log("alternativaCorreta está no componente: " + alternativaCorreta)
                alternativaCorreta = option.labels[0].id
            }
        })

        // verifica se resposta assinalada é correta
        options.forEach((option) => {
            if (option.checked === true && option.value === respostaQuestaoAtual) {
                document.getElementById(alternativaCorreta).classList.add("textocorreta")
                pontuacaoFinal++
                certas++
                numeroDaQuestaoAtual++
            } else if (option.checked && option.value !== respostaQuestaoAtual) {
                const wrongLabelId = option.labels[0].id

                document.getElementById(wrongLabelId).classList.add("textoerrada")
                document.getElementById(alternativaCorreta).classList.add("textocorreta")
                tentativaIncorreta++
                erradas++
                numeroDaQuestaoAtual++
            }
        })
    }

    function limparCoresBackgroundOpcoes() {
        const options = document.getElementsByName("option");
        options.forEach((option) => {
            document.getElementById(option.labels[0].id).classList.remove("textoerrada")
            document.getElementById(option.labels[0].id).classList.remove("textocorreta")
        })
    }

    function desmarcarRadioButtons() {
        const options = document.getElementsByName("option");
        for (let i = 0; i < options.length; i++) {
            options[i].checked = false;
        }
    }

    function finalizarJogo() {
        const porcentagemFinalDeAcertos = pontuacaoFinal / quantidadeDeQuestoes

        questoes.innerHTML = ''
        questaoAt.innerHTML = ''
        informacao.innerHTML = ''
        opcoes.innerHTML = ''

        finalAcertos.innerHTML = pontuacaoFinal
        quantQuestoes2.innerHTML = quantidadeDeQuestoes

        if (pontuacaoFinal >= 0 && pontuacaoFinal <= 2) {
            tituloClassificacao.innerHTML = 'Sem Teia'
            txtClassificacao.innerHTML = 'Conhecimento nível zero. Você não sabe nada do Teioso! É hora de começar a ler os quadrinhos.'
        } else if (pontuacaoFinal <= 4) {
            tituloClassificacao.innerHTML = 'Fotógrafo Amador'
            txtClassificacao.innerHTML = 'Você sabe o nome do herói, mas precisa aprender os inimigos e as regras. Estude um pouco mais!'
        } else if (pontuacaoFinal <= 6) {
            tituloClassificacao.innerHTML = 'Vizinho Amigável'
            txtClassificacao.innerHTML = 'Conhece o básico e os vilões principais. Um bom cidadão, mas precisa de mais dedicação para ser um fã de verdade.'
        } else if (pontuacaoFinal <= 9) {
            tituloClassificacao.innerHTML = 'Mestre dos Lançadores'
            txtClassificacao.innerHTML = 'Seu Sentido Aranha está quase perfeito! Você domina o universo do teioso. Fantástico! Quase lá.'
        } else {
            tituloClassificacao.innerHTML = 'O Aranha Supremo'
            txtClassificacao.innerHTML = 'ESPETACULAR! Seu conhecimento é impecável. Você é o maior fã e o verdadeiro Homem-Aranha! Parabéns!'
        }

        fetch("/usuarios/quiz", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    pontuacaoFinalServer: pontuacaoFinal,
                    idServer: sessionStorage.ID_USUARIO
                }),
            })

        btnDash.style.display = "block"
        btnProx.disabled = true
        btnSubmeter.disabled = true

        btnProx.style.display = "none"
        btnSubmeter.style.display = "none"
        // btnConcluir.disabled = true
        btnTentarNovamente.disabled = false

    }

    function resultados() {
        window.location.href = "dashboard/inicial.html"
    }
</script>
</html>